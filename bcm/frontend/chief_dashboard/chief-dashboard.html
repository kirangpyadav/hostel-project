<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chief Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: #f4f6f9; color: #333; }
        .top-header { background-color: #2c3e50; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .profile-info { display: flex; align-items: center; gap: 1rem; }
        .profile-pic { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #17a2b8; }
        .profile-details h2 { margin: 0; font-size: 1.2em; font-weight: 500; }
        .profile-details p { margin: 0; font-size: 0.8em; opacity: 0.8; }
        .header-center h1 { margin: 0; font-size: 1.8em; }
        .logout-btn { background-color: #e74c3c; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 5px; font-weight: 600; cursor: pointer; }
        .dashboard-container { padding: 2rem; max-width: 900px; margin: 2rem auto; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .dashboard-card { background: #fff; border-radius: 12px; padding: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.08); text-align: center; }
        .card-icon { font-size: 3rem; margin-bottom: 1rem; }
        .dashboard-card h3 { margin: 0 0 0.5rem 0; font-size: 1.4rem; }
        .dashboard-card p { font-size: 0.95em; color: #666; line-height: 1.6; min-height: 50px; }
        .card-button { display: inline-block; margin-top: 1.5rem; padding: 0.7rem 2rem; font-size: 1em; font-weight: 600; color: white; border: none; border-radius: 25px; cursor: pointer; text-decoration: none; }
        .meal-btn { background-color: #28a745; }
        .ration-btn { background-color: #ffc107; color: #333; }
    </style>
</head>
<body>

    <div class="top-header">
        <div class="profile-info">
            <img id="profilePic" src="https://placehold.co/100x100/EFEFEF/AAAAAA&text=..." alt="Profile Photo" class="profile-pic">
            <div class="profile-details">
                <h2 id="chiefName">Loading...</h2>
                <p id="chiefIdDisplay"></p>
            </div>
        </div>
        <div class="header-center"><h1>Chief Dashboard</h1></div>
        <button id="logoutBtn" class="logout-btn">Logout</button>
    </div>

    <div class="dashboard-container">
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <i class="fas fa-utensils card-icon" style="color: #28a745;"></i>
                <h3>Meal Counts</h3>
                <p>View daily student meal confirmations for breakfast, lunch, and dinner.</p>
                <a href="chief_meal_counts.html" class="card-button meal-btn">View Counts</a>
            </div>
            <div class="dashboard-card">
                <i class="fas fa-boxes-stacked card-icon" style="color: #ffc107;"></i>
                <h3>Request Rations</h3>
                <p>Request new ration items from the main godown or storeroom.</p>
                <a href="chief_request_ration.html" class="card-button ration-btn">Request Items</a>
            </div>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const chiefId = localStorage.getItem('chiefId');
        const chiefName = localStorage.getItem('chiefName');

        if (!chiefId) {
            alert('You are not logged in. Redirecting...');
            window.location.href = '/chief-login.html';
            return;
        }

        document.getElementById('chiefName').textContent = chiefName || 'Chief';
        
        try {
            const response = await fetch(`/api/chief-auth/profile/${chiefId}`);
            const result = await response.json();
            
            if (result.success && result.chief) {
                document.getElementById('chiefIdDisplay').textContent = `ID: ${result.chief.loginId}`;
                if (result.chief.photo) {
                    document.getElementById('profilePic').src = `/uploads/${result.chief.photo}`;
                } else {
                    document.getElementById('profilePic').src = 'https://placehold.co/100x100/EFEFEF/AAAAAA&text=No+Photo';
                }
            } else {
                throw new Error(result.message || 'Failed to load profile.');
            }
        } catch (error) {
            console.error("Failed to fetch chief profile:", error);
            document.getElementById('chiefIdDisplay').textContent = 'Error loading profile';
        }

        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('chiefId');
            localStorage.removeItem('chiefName');
            window.location.href = '/hostel-home.html';
        });
    });
</script>
</body>
</html>

